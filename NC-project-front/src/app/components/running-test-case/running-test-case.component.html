<div class="mr-5">
  <div class="bg-white shadow-lg px-5 py-2">
    <nav mat-tab-nav-bar>
      <a mat-tab-link [routerLink]="['../list']">Test Scenarios</a>
      <a mat-tab-link [routerLink]="['../list']">Test Cases</a>
      <a mat-tab-link [routerLink]="['../runningList']" [active]="true">Running Test Cases</a>
      <a mat-tab-link [routerLink]="['../runningList']">History Test Cases</a>
    </nav>

    <div class="example-container">
      <h2 class="p-0">Running test case</h2>
    </div>

    <div class="form-group">
      <input class="form-control float-left col-4 input-sm mt-2" id="input" type="text" #input
         matInput placeholder="Search by name..." (keyup)="applyFilter($event)">
    </div>

    <div cdkDropListGroup class="row actions-container w-100 p-0 m-0">
      <table mat-table [dataSource]="dataSource" class="float-left" matSort (matSortChange)="sortData()" multiTemplateDataRows>

             <ng-container matColumnDef="test_case_id">
               <th mat-header-cell *matHeaderCellDef [hidden]="true"></th>
               <td mat-cell *matCellDef="let element" [hidden]="true"> {{element.test_case_id}} </td>
             </ng-container>

             <ng-container matColumnDef="name">
               <th mat-header-cell style="width: 25%;" *matHeaderCellDef mat-sort-header>Name</th>
               <td mat-cell class="w3-link w3-text-blue" style="cursor: pointer;" *matCellDef="let element" [matTooltip]="element.description"> {{element.name}} </td>
             </ng-container>

             <ng-container matColumnDef="starter_id">
               <th mat-header-cell style="width: 25%;" *matHeaderCellDef>Started by</th>
               <td mat-cell *matCellDef="let element"> User{{element.starter_id}} </td>
             </ng-container>

             <ng-container matColumnDef="watcher_numb">
               <th mat-header-cell style="width: 25%;" *matHeaderCellDef>Watcher</th>
               <td mat-cell *matCellDef="let element" style="cursor: pointer; font-style: italic;"
               (click)="reloadWatchers(element.test_case_id); expandedElement = expandedElement === element ? null : element"> List of {{element.watcher_numb}} </td>
             </ng-container>

             <ng-container matColumnDef="status">
               <th mat-header-cell style="width: 18%;" *matHeaderCellDef>Status</th>
               <td mat-cell *matCellDef="let element"> {{element.status}} </td>
             </ng-container>

             <ng-container matColumnDef="stop/run">
               <th mat-header-cell style="width: 7%;" *matHeaderCellDef >Stop/Run</th>
               <td mat-cell *matCellDef="let element;">
                 <div *ngIf="element.status === 'Stopped'">
                    <mat-slide-toggle color='primary' [checked]="false" (change)="updateStatus($event, element.test_case_id); onChangeStatus(element.test_case_id)" ></mat-slide-toggle>
                </div>
                <div *ngIf="element.status != 'Stopped'">
                   <mat-slide-toggle color='primary' [checked]="true" (change)="updateStatus($event, element.test_case_id); onChangeStatus(element.test_case_id)" ></mat-slide-toggle>
               </div>
               </td>
             </ng-container>




        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="5">

            <div style="display:block;" class="example-element-detail"
                 [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                   <p >List of wachers</p>
              <table mat-table [dataSource]="dataSource2" style="width: 50%; float:left;">

                <!-- Position Column -->
                <ng-container matColumnDef="user_id">
                  <th mat-header-cell *matHeaderCellDef style="width: 15%;" [hidden]="true" > ID </th>
                  <td mat-cell *matCellDef="let element2" [hidden]="true"> {{element2.user_id}} </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef style="width: 30%;"> Name </th>
                  <td mat-cell *matCellDef="let element2"> {{element2.name}} </td>
                </ng-container>

                <!-- Weight Column -->
                <ng-container matColumnDef="surname">
                  <th mat-header-cell *matHeaderCellDef style="width: 35%;"> Surname </th>
                  <td mat-cell *matCellDef="let element2"> {{element2.surname}} </td>
                </ng-container>

                <!-- Symbol Column -->
                <ng-container matColumnDef="role">
                  <th mat-header-cell *matHeaderCellDef style="width: 2%;"> Role </th>
                  <td mat-cell *matCellDef="let element2"> {{element2.role}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="columnsToDisplay2"></tr>
                <tr mat-row *matRowDef="let row2; columns: columnsToDisplay2;"></tr>
              </table>

               <mat-form-field  class="example-full-width  float-left ml-5" style="width: 32%;">

                  <input matInput #inputName (change)="reloadUsers(inputName.value);" placeholder="Search watcher" [matAutocomplete]="auto" [formControl]="watchersCtrl">

                  <mat-autocomplete #auto="matAutocomplete" >
                    <mat-option *ngFor="let watcher of filteredWatchers | async" [value]="watcher.name+' '+watcher.surname"
                    (onSelectionChange)="updateUserID(watcher.userId)">

                      <span>{{watcher.name}} {{watcher.surname}}</span>
                      <small> [{{watcher.role}}]</small>

                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <a  class="btn btn-nc ml-3 px-3" color='primary'
                   style="background-color: #0275B1;"
                   (click)="addWatcher(element.test_case_id) ? openSnackBar('This user has been assigned as a watcher!','success', '') : openSnackBar('This user is already assigned or does not exist!','error', '')">Add</a>

            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
        <tr mat-row *matRowDef="let element; columns: columnsToDisplay;"
            class="example-element-row"
            [class.example-expanded-row]="expandedElement === element"
            >
        </tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      </table>
    </div>
    <mat-paginator (page)="onPaginationChange($event)"
                   [length]="length"
                   [pageSizeOptions]="pageSizeOptions"
                   [pageSize]="pageSize" showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
